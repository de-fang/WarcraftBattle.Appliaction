<Window x:Class="WarcraftBattle.Editor.Views.ShellView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:cal="http://www.caliburnproject.org"
        Title="{Binding DisplayName}"
        Height="800"
        Width="1300"
        Background="#1E1E1E"
        Foreground="#F0F0F0">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="320" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Column="0" Margin="12" Orientation="Vertical">
            <TextBlock Text="Stages" FontSize="16" FontWeight="Bold" Margin="0,0,0,6" />
            <ListBox ItemsSource="{Binding Stages}"
                     SelectedItem="{Binding SelectedStage}"
                     DisplayMemberPath="DisplayName"
                     Height="300" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                <Button Content="Load Config" Margin="0,0,8,0" cal:Message.Attach="LoadConfig" />
                <Button Content="Save Config" cal:Message.Attach="SaveConfig" />
            </StackPanel>
            <Separator Margin="0,12,0,12" />
            <TextBlock Text="Obstacle Palette" FontSize="14" FontWeight="Bold" Margin="0,0,0,6" />
            <ListBox ItemsSource="{Binding ObstaclePalette}"
                     SelectedItem="{Binding SelectedObstacleDef}"
                     DisplayMemberPath="Name"
                     Height="180" />
            <Button Content="Add Obstacle" Margin="0,6,0,0" cal:Message.Attach="AddObstacle" />
            <Separator Margin="0,12,0,12" />
            <TextBlock Text="Building Palette" FontSize="14" FontWeight="Bold" Margin="0,0,0,6" />
            <ListBox ItemsSource="{Binding BuildingPalette}"
                     SelectedItem="{Binding SelectedBuildingInfo}"
                     DisplayMemberPath="Name"
                     Height="180" />
            <Button Content="Add Building" Margin="0,6,0,0" cal:Message.Attach="AddBuilding" />
        </StackPanel>

        <Border Grid.Column="1" Margin="8" BorderThickness="1" BorderBrush="#3C3C3C" Background="#252526">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                <Canvas Width="{Binding MapWidth}"
                        Height="{Binding MapHeight}"
                        Background="#2D2D30">
                    <ItemsControl ItemsSource="{Binding Obstacles}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Canvas.Left" Value="{Binding X}" />
                                <Setter Property="Canvas.Top" Value="{Binding Y}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Thumb Width="{Binding Width}"
                                       Height="{Binding Height}"
                                       Tag="{Binding}"
                                       DragDelta="OnDragDelta"
                                       MouseLeftButtonDown="OnItemMouseDown">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="#A84E4E" BorderBrush="#E0E0E0" BorderThickness="1">
                                                <TextBlock Text="{Binding DisplayName}"
                                                           Foreground="White"
                                                           FontSize="11"
                                                           TextWrapping="Wrap"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           Margin="4" />
                                            </Border>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                </Thumb>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <ItemsControl ItemsSource="{Binding Placements}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Canvas.Left" Value="{Binding X}" />
                                <Setter Property="Canvas.Top" Value="{Binding Y}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Thumb Width="{Binding Width}"
                                       Height="{Binding Height}"
                                       Tag="{Binding}"
                                       DragDelta="OnDragDelta"
                                       MouseLeftButtonDown="OnItemMouseDown">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="#4E7EA8" BorderBrush="#E0E0E0" BorderThickness="1">
                                                <TextBlock Text="{Binding DisplayName}"
                                                           Foreground="White"
                                                           FontSize="11"
                                                           TextWrapping="Wrap"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           Margin="4" />
                                            </Border>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                </Thumb>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Canvas>
            </ScrollViewer>
        </Border>

        <StackPanel Grid.Column="2" Margin="12" Orientation="Vertical">
            <TextBlock Text="Selection" FontSize="16" FontWeight="Bold" Margin="0,0,0,8" />
            <Border BorderThickness="1" BorderBrush="#3C3C3C" Padding="8" Background="#252526">
                <StackPanel DataContext="{Binding SelectedItem}">
                    <TextBlock Text="{Binding DisplayName}" FontSize="14" FontWeight="Bold" />
                    <TextBlock Text="{Binding Kind}" FontSize="12" Margin="0,0,0,8" />
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="X" Width="20" />
                        <TextBox Text="{Binding X, UpdateSourceTrigger=PropertyChanged}" Width="80" />
                        <TextBlock Text="Y" Width="20" Margin="12,0,0,0" />
                        <TextBox Text="{Binding Y, UpdateSourceTrigger=PropertyChanged}" Width="80" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="W" Width="20" />
                        <TextBox Text="{Binding Width, UpdateSourceTrigger=PropertyChanged}" Width="80" />
                        <TextBlock Text="H" Width="20" Margin="12,0,0,0" />
                        <TextBox Text="{Binding Height, UpdateSourceTrigger=PropertyChanged}" Width="80" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="Rot" Width="20" />
                        <TextBox Text="{Binding Rotation, UpdateSourceTrigger=PropertyChanged}" Width="80" />
                    </StackPanel>
                </StackPanel>
            </Border>
            <Button Content="Remove Selected"
                    Margin="0,8,0,0"
                    IsEnabled="{Binding HasSelection}"
                    cal:Message.Attach="RemoveSelected" />
            <Separator Margin="0,12,0,12" />
            <TextBlock Text="Stage Info" FontSize="14" FontWeight="Bold" />
            <StackPanel Margin="0,6,0,0">
                <TextBlock Text="{Binding SelectedStage.DisplayName}" />
                <TextBlock Text="{Binding MapWidth, StringFormat=Width: {0}}" />
                <TextBlock Text="{Binding MapHeight, StringFormat=Height: {0}}" />
            </StackPanel>
        </StackPanel>

        <Border Grid.ColumnSpan="3" Grid.Row="1" Background="#252526" Padding="8">
            <TextBlock Text="{Binding StatusMessage}" />
        </Border>
    </Grid>
</Window>
